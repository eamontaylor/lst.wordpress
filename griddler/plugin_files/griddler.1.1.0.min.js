(function(e){e.fn.Griddler=function(t){function g(){r.featWidth=2/n.columns*100;r.featHeight=2/r.totalRowQt*100;r.projTopWidth=r.width-r.featWidth;r.topRegWidth=1/(n.columns-2)*100;r.topRegHeight=50;r.regWidth=1/n.columns*100;r.regHeight=1/r.btmRowQt*100}function y(){r.featWidth=r.width;r.featHeight=n.columns/r.totalRowQt*100;r.projTopWidth=r.width-r.featWidth;r.topRegWidth=1/n.columns*100;r.topRegHeight=1/r.topRowQt*100;r.regWidth=r.topRegWidth;r.regHeight=1/r.btmRowQt*100}function b(){r.featWidth=r.width;r.featHeight=1/r.rowQt*100;r.projTopWidth=r.width;r.topRegWidth=r.width;r.topRegHeight=1/r.topRowQt*100;r.regWidth=r.width;r.regHeight=1/r.btmRowQt*100;n.columns=1}function w(){r.topRegWidth=1/n.columns*100;r.topRegHeight=1/r.topRowQt*100;r.featHeight=r.topRowQt/r.totalRowQt*100;r.regWidth=r.topRegWidth;r.regHeight=1/r.btmRowQt*100}function E(t){r.width=100;r.parentWidthPX=e("#"+c+"").width();if(n.columns<=2&&n.featureGrid==="inline"){n.featureGrid="disable";n.columns=1}else if(n.columns<2&&n.featureGrid==="top"){n.featureGrid="disable";n.columns=1}if(n.featureGrid!=="disable"){if(n.columns>2&&n.featureGrid==="inline"){r.topCap=(n.columns-2)*2;r.rowQt=Math.ceil((v-(r.topCap+1))/n.columns);if(v-1>=(n.columns-2)*2){r.topRowQt=2;r.btmRowQt=Math.ceil((v-1-r.topCap)/n.columns)}else{r.topRowQt=Math.ceil((v-1)/n.columns);r.btmRowQt=0}r.totalRowQt=r.topRowQt+r.btmRowQt;g()}else if(n.columns>=2&&n.featureGrid==="top"){r.rowQt=Math.ceil((v-1)/n.columns);r.topCap=n.columns*Math.floor(r.rowQt/2);r.topRowQt=r.topCap/n.columns;r.btmRowQt=r.rowQt-r.topRowQt;r.totalRowQt=n.columns+r.topRowQt+r.btmRowQt;y()}else{r.rowQt=v;r.topCap=n.columns*Math.floor((r.rowQt-1)/2);r.topRowQt=r.topCap;r.btmRowQt=r.rowQt-1-r.topRowQt;r.totalRowQt=v;b()}}else{r.rowQt=Math.ceil(v/n.columns);r.topCap=n.columns*Math.floor(r.rowQt/2);r.topRowQt=r.topCap/n.columns;r.btmRowQt=Math.ceil((v-r.topCap)/n.columns);r.totalRowQt=Math.ceil(v/n.columns);w()}}function S(){if(r.dataIsSet==="set"){return}var t,s;if(n.featureGrid!=="disable"){e("#featured_project").append(p[0]);for(i=1;i<d;i++){if(i<=r.topCap){e("#project_top").append(p[i])}else{e("#project_btm").append(p[i])}}}else{for(i=0;i<d;i++){if(i<r.topCap){e("#project_top").append(p[i])}else{e("#project_btm").append(p[i])}}}e(l).remove();(function(){if(d!==0&&n.expandLimit===true&&h-n.gridLimit>0&&h-v>0){if(e("#griddler_load").length<1){r.loaderExists=true;e('<div id="griddler_load">Load More</div>').insertAfter("#project_btm");r.loaderHeight=e("#griddler_load").height()+parseInt(e("#griddler_load").css("paddingTop"),10)+parseInt(e("#griddler_load").css("paddingBottom"),10)+parseInt(e("#griddler_load").css("marginTop"),10)+parseInt(e("#griddler_load").css("marginBottom"),10)}}else{r.loaderExists=false;r.loaderHeight=0}})();e("#"+c+"").css({height:x(),paddingBottom:r.loaderHeight,overflow:"hidden"});r.dataIsSet="set"}function x(){var t;r.topRowQt;r.btmRowQt;r.totalRowQt;var i=e("#"+c+"").width();var s=(i/n.columns-2*n.margin)*n.ratio;t=r.totalRowQt*(s+2*n.margin);return t}function T(t,n,r){var s=this;this.targ=t;var o;this.width=n;this.height=r;if(typeof this.targ==="object"){o=this.targ[0];for(i=1;i<this.targ.length;i++){o=o+", "+this.targ[i]}}else{o=this.targ}if(a){e(o).css({width:Math.floor(this.width)+"%",height:Math.floor(this.height)+"%"})}else{e(o).css({width:this.width+"%",height:this.height+"%"})}e(o).find("a").each(function(t){var n=e(this);n.css({width:"100%",height:"100%",overflow:"hidden",display:"inline-block"})});e(o).find("img").each(function(t){var n=e(this);var r=n.attr("src");n.attr("src",r+"?"+(new Date).getTime());if(n.attr("class")!=="sized"){n.css("opacity","0")}n.on("load",function(){s.imgFillr(n,s.width,s.height)})})}function N(t,n){$this=this;this.target=t;this.iframe=n;$lightbox=e("#lightbox");this.windowWidth=parseInt(e(window).width(),10);this.windowHeight=parseInt(e(window).height(),10);this.lbPaddingTop=parseInt($lightbox.css("paddingTop"));this.lbPaddingRight=parseInt($lightbox.css("paddingRight"));this.lbPaddingBottom=parseInt($lightbox.css("paddingBottom"));this.lbPaddingLeft=parseInt($lightbox.css("paddingLeft"));this.closeWidth=parseInt(e("#close_lightbox").css("width"),10);this.createDisplayElement();$lightboxImage=e("#lb_element");image={};image.src=this.target.attr("href");e("embed, select, object").css("visibility","hidden");this.init()}function C(){if(n.rollover!==false){e(".project_info",this).stop(true,true).fadeIn(300);e(".project_info h2",this).stop(true,true).animate({top:"40%"})}}function k(){if(n.rollover!==false){e(".project_info",this).stop(true,true).fadeOut();e(".project_info h2",this).stop(true,true).animate({top:"120%"},300)}}function L(t){if(a){var n=this.firstChild.firstChild;n.setAttribute("id","Light");if(n.className==="lightbox"||n.className("class")==="iframe"){t.preventDefault();iframe=n.className==="iframe"?"true":"false";new N(e("#Light"),iframe)}else{window.location=n.getAttribute("href")}n.removeAttribute("id")}else{var n=e(this).children("a");if(n.attr("class")==="lightbox"||n.attr("class")==="iframe"){t.preventDefault();iframe=n.attr("class")==="iframe"?"true":"false";new N(n,iframe)}else{window.location=n.attr("href")}}}function A(){var t=parseInt(e("#project_top li").css("height"),10)*.1+"px";r.FontSize=t;return t}function O(){function t(){var t=h-v>=n.columns*2?n.columns*2:h-v;var s=e("#project_btm li").length;if(s>0){var o=Math.ceil((s+t)/n.columns);var u=o-r.btmRowQt;r.totalRowQt=r.totalRowQt+u;r.btmRowQt=r.btmRowQt+u;function f(){if(n.featureGrid!=="disable"){if(n.columns>2&&n.featureGrid==="inline"){g()}else if(n.columns>=2&&n.featureGrid==="top"){y()}else{b()}}else{w()}e("#"+c+"").css({height:x()});for(i=0;i<t;i++){var s=v+i;e("#project_btm").append(p[s]);e(p[s]).attr("id","appended_"+s+"").css({boxSizing:"border-box",padding:n.margin,overflow:"hidden"});if(a){e("#appended_"+s).css({padding:"0px",overflow:"hidden",fontSize:r.FontSize,display:"inline-block"}).wrapInner("<div class='grid_wrapper'></div>");e("#appended_"+s+" .grid_wrapper").css({padding:n.margin})}e("#appended_"+s+" h2").css({fontSize:r.FontSize});e(p[s]).bind("click",L);e(p[s]).bind("mouseenter",C);e(p[s]).bind("mouseleave",k)}new T("#featured_project",r.featWidth,r.featHeight);if(n.featureGrid==="inline"&&n.columns>2){new T("#project_top",r.projTopWidth,r.featHeight)}else{new T("#project_top",r.width,r.topRowQt/r.totalRowQt*100)}new T("#project_btm",r.width,r.btmRowQt/r.totalRowQt*100);new T(["#featured_project li"],100,100);new T(["#project_top li"],r.topRegWidth,r.topRegHeight);new T(["#project_btm li"],r.regWidth,r.regHeight);e("#project_btm .project_info").css({width:"100%",height:"100%",padding:n.margin,backgroundClip:"content-box",boxSizing:"border-box"})}f()}(function(){e("#featured_project .project_info, #project_top .project_info, #project_btm .project_info").css({width:"100%",height:"100%"});v=v+t})();if(h-v<=0){r.loaderExists=false;e("#griddler_load").remove()}}e(l).css("visibility","none");if(e("#lightbox_wrapper").length<1){e("#"+c+"").append(m+'<ul id="featured_project"></ul><ul id="project_top"></ul><ul id="project_btm"></ul>')}if(n.featureGrid!=="disable"){if(n.columns>=2&&n.featureGrid==="top"){new T("#featured_project",r.featWidth,r.featHeight);S();e("#project_top").css({width:r.width+"%",height:r.topRowQt/r.totalRowQt*100+"%"});e("#project_btm").css({width:r.width+"%",height:r.btmRowQt/r.totalRowQt*100+"%"});new T(["#project_top li"],r.topRegWidth,r.topRegHeight);new T(["#project_btm li"],r.regWidth,r.regHeight);new T(["#featured_project li"],r.featWidth,100);e("#featured_project .project_info").css({height:r.featHeight})}else if(n.columns>2&&n.featureGrid==="inline"){e("#featured_project").css({width:r.featWidth+"%",height:r.featHeight+"%"});S();e("#project_top").css({width:r.projTopWidth+"%",height:r.featHeight+"%"});e("#project_btm").css({width:r.width+"%",height:r.btmRowQt/r.totalRowQt*100+"%"});new T(["#featured_project li"],100,100);new T(["#project_top li"],r.topRegWidth,r.topRegHeight);new T(["#project_btm li"],r.regWidth,r.regHeight)}else{e("#featured_project").css({width:r.featWidth+"%",height:r.featHeight+"%"});S();e("#project_top").css({width:r.width+"%",height:r.btmRowQt/r.totalRowQt*100+"%"});e("#project_btm").css({width:r.width+"%",height:r.btmRowQt/r.totalRowQt*100+"%"});new T(["#featured_project li"],100,100);new T(["#project_top li"],r.topRegWidth,r.topRegHeight);new T(["#project_btm li"],r.regWidth,r.regHeight)}}else{if(e("#lightbox_wrapper").length<1){e("#"+c+"").append(m+'<ul id="project_top"></ul><ul id="project_btm"></ul>')}e("#project_top").css({width:r.width+"%",height:r.topCap/n.columns/r.rowQt*100+"%"});e("#project_btm").css({width:r.width+"%",height:(r.rowQt-r.topCap/n.columns)/r.rowQt*100+"%"});S();new T(["#project_top li"],r.topRegWidth,100/r.topRowQt);new T(["#project_btm li"],r.regWidth,100/r.btmRowQt);new T(["#featured_project li, #featured_project .project_info"],r.featWidth,100)}if(a){e("#featured_project li, #project_top li, #project_btm li").wrapInner("<div class='grid_wrapper'></div>");e("#featured_project li, #project_top li, #project_btm li").css({padding:"0px",overflow:"hidden",display:"inline-block"});e(".grid_wrapper").css({padding:n.margin})}else{e("#featured_project li, #project_top li, #project_btm li").css({boxSizing:"border-box",padding:n.margin,overflow:"hidden"})}e("#featured_project .project_info, #project_top .project_info, #project_btm .project_info").css({width:"100%",height:"100%",padding:n.margin,backgroundClip:"content-box",boxSizing:"border-box"});if(r.loaderExists){e("#griddler_load").click(function(){t()})}}var n=e.extend({ratio:"16:9",margin:5,columns:4,featureGrid:"inline",rollover:true,gridLimit:13,expandLimit:true},t);var r={};var s=n.ratio.split(":");n.ratio=s[1]/s[0];if(isNaN(n.ratio)||n.ratio==="undefined"){n.ratio=1}var o=navigator.userAgent;var u=/MSIE 7.0/i;var a=u.test(o);var f=/Chrome/i.test(o);var l=this;var c=e(l).parent().attr("id");var h=e(l).children().length;var p=e(l).find("li");var d=Number(n.gridLimit)!==0?n.gridLimit:h;var v=d;var m='<div id="lightbox_wrapper"><div id="lightbox"><div id="close_lightbox"></div></div></div>';E(parseInt(e(l).css("width"),10)-1);T.prototype.imgFillr=function(e,t,r){$__this=this;this.image1=e;this.iSrc=this.image1.attr("src");this.width1=t;this.height1=r;this.ratioRule=this.height1/this.width1;this.imageState=this.image1.attr("class");if(this.imageState==="sized"){return}this.imageW=parseInt(this.image1.css("width"),10);this.imageH=parseInt(this.image1.css("height"),10);this.ratioImage=this.imageH/this.imageW;if(this.ratioImage!==n.ratio){if(this.ratioImage<n.ratio){this.finalHeight="100%";this.finalWidth=f===true?this.imageW*s[1]/this.imageH/s[0]*100+"%":"auto"}else{this.finalHeight="auto";this.finalWidth="100%"}}else{this.finalHeight="100%";this.finalWidth="100%"}this.image1.addClass("sized").css({width:this.finalWidth,height:this.finalHeight}).animate({opacity:"1"})};N.prototype.createDisplayElement=function(){if($this.iframe==="true"){var t=this.target.attr("href");var n;var r;var i=t.search("vimeo");var s=t.search("youtu");if(i===-1&&s===-1){n=$this.windowWidth-($this.lbPaddingLeft+$this.lbPaddingRight+$this.closeWidth+100);r=$this.windowHeight-($this.lbPaddingTop+$this.lbPaddingBottom+100)}else{n=560;r=315}e('<iframe id="lb_element" src="" width="'+n+'" height="'+r+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>').insertBefore("#close_lightbox")}else{e('<img id="lb_element" src="" alt="" />').insertBefore("#close_lightbox")}};N.prototype.init=function(){_this=this;$lightboxImage.attr("src",image.src).css({display:"none"});e("#lightbox_wrapper").show();$lightboxImage.on("load",function(){$this.display()})};N.prototype.display=function(){paddingVertical=$this.lbPaddingTop+$this.lbPaddingBottom;paddingSide=$this.lbPaddingRight+$this.lbPaddingLeft;image.width=parseInt($lightboxImage.css("width"),10);image.height=parseInt($lightboxImage.css("height"),10);image.ratio=image.width/image.height;if(image.height+paddingVertical>$this.windowHeight){image.height=$this.windowHeight-paddingVertical;image.width=image.height*image.ratio;$lightboxImage.css({width:image.width,height:image.height})}if(image.width>$this.windowWidth-(paddingSide+$this.closeWidth*2)){image.width=$this.windowWidth-(paddingSide+$this.closeWidth*2);image.height=image.width/image.ratio;$lightboxImage.css({width:image.width,height:image.height})}$lightbox.css("top",($this.windowHeight-(image.height+paddingVertical))/2);$lightbox.animate({width:image.width,height:image.height},500,function(){$lightboxImage.fadeIn()})};N.prototype.collapse=function(){$lightboxImage.stop(true,true).css({width:"auto",height:"auto",display:"none"}).remove();$lightbox.stop(true,true).css({width:"0px",height:"0px"});e("#lightbox_wrapper").stop(true,true).hide();e("embed, select, object").css("visibility","visible")};var M=function(){var e=0;return function(t,n,i){if(r.resizeState==="inactive"){clearTimeout(e);e=setTimeout(t,n)}}}();O();e("#featured_project li, #project_top li, #project_btm li").bind("click",L);e("#close_lightbox").click(function(){$this.collapse()});e("#featured_project li, #project_top li, #project_btm li").bind("mouseenter",C);e("#featured_project li .project_info h2, #project_top li .project_info h2, #project_btm li .project_info h2").css({fontSize:A()});e("#featured_project li, #project_top li, #project_btm li").bind("mouseleave",k);r.resizeState="inactive";e(window).resize(function(){M(function(){r.resizeState="active";e("#"+c+"").css("overflow","hidden").animate({height:x()},350,function(){e("#featured_project li .project_info h2, #project_top li .project_info h2, #project_btm li .project_info h2").css({fontSize:A()})});r.resizeState="inactive"},500,r.resizeState)})}})(jQuery)